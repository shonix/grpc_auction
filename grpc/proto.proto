syntax = "proto3";
option go_package = "auction/grpc";

message BidRequest {
  int64 lamport_timestamp = 1;
  string client_id = 2;
  int64 amount = 3;
}

message Acknowledgement {
  int64 lamport_timestamp = 1;
  string server_id = 2;
  string status = 3;
}

message SubscribeRequest {
  int64 lamport_timestamp = 1;
  string client_id = 2;
}

message Result {
int64 lamport_timestamp = 1;
string server_id =2;
int64 amount = 3;
string client_id = 4;
}

message QueryRequest {
  int64 lamport_timestamp = 1;
  string client_id= 2;
}

message AuctionStatus{
  int64 lamport_timestamp = 1;
  string server_id = 2;
  string client_id = 3;
  int64 highest_bid = 4;
  string leader_id = 5;
}

enum Status {
  FAIL = 0;
  SUCCESS = 1;
  EXCEPTION = 2;
}

service Bidding {
  rpc Bid (stream BidRequest) returns (stream Acknowledgement) {};
}

service Auction{
  rpc Subscribe (SubscribeRequest) returns (stream Result) {};
}

service Query {
  rpc GetAuctionStatus (QueryRequest) returns (AuctionStatus) {};
}

// NODE TO NODE COMMUNICATION :

message Ping {
  int64 lamport_timestamp = 1;
  string leader_id = 2;
}

message PingReply {
  int64 lamport_timestamp = 1;
  string node_id = 2;
  bool alive = 3;
}

message VoteRequest {
  int64 lamport_timestamp = 1;
  string candidate_id = 2;
}

message VoteReply {
  int64 lamport_timestamp = 1;
  string node_id = 2;
  bool vote_granted = 3;
}

message StateUpdate {
  int64 lamport_timestamp = 1;
  string leader_id = 2;
  int64 highest_bid = 3;
  string highest_bidder = 4;
  bool auction_over = 5;
}

message StateAck {
  int64 lamport_timestamp = 1;
  string node_id = 2;
  bool accepted = 3;
}

service NodeToNode {
  rpc SendPing (Ping) returns (PingReply) {};
  rpc AskForVote (VoteRequest) returns (VoteReply) {};
  rpc SendStateUpdate (StateUpdate) returns (StateAck) {};
}
